# Ethereum Gas & Smart Contracts

## Meet the Magician: What Are Smart Contracts?

![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/image.webp?raw=true)

Smart contracts are the wizards of the blockchain world—self-executing programs that live on the blockchain. They automatically enforce agreements between parties without the need for middlemen, bringing trust, transparency, and efficiency to the table. Imagine a vending machine for agreements: insert conditions, and voila—the magic happens!

## Why They’re Magical

- **Self-Executing:** Once deployed, they run on autopilot.
- **Immutable:** Set in stone once written to the blockchain.
- **Decentralized:** No central authority pulling the strings.

![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/image%201.webp?raw=true)

In Ethereum’s realm, smart contracts are the foundation of decentralized applications (dApps), enabling developers to create automated and trustless systems.

## Speaking the Language of Wizards: Solidity

Solidity is the spellbook—the programming language used to craft Ethereum smart contracts. Its syntax is intuitive and developer-friendly, inspired by familiar languages like JavaScript and C++.

### Top Features of Solidity:

- **Simple Syntax:** Clear and concise, perfect for blockchain sorcery.
- **Contract-Oriented:** Tailored for decentralized applications.
- **Reusable Code:** Supports libraries and inheritance for modular magic.

Here’s a simple spell, a “Hello World” smart contract in Solidity:

```jsx
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0; // Solidity version

contract HelloWorld {
    string public message;               

    constructor() {
        message = "Hello, World!";
    }
}
```

### Hands-On Wizardry: Building a Smart Contract

Let’s create a simple smart contract to transfer ETH to another account using Remix, Ethereum’s magical workspace.

### Steps to Cast the Spell

1. **Prepare the Workspace:**
    - Open [Remix IDE](https://remix.ethereum.org/).
    - Create a new Solidity file (e.g., `EthTransfer.sol`).
2. **Write the Spell:**
Here’s the Solidity code:

```jsx
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

event Transfer(uint256 value,address indexed from,address indexed to,uint256 timestamp);

contract EthTransfer 
{
		 function transferEth(address payable _to) public payable 
		 {
		        require(msg.value > 0, "Must send some ETH");
		        _to.transfer(msg.value);
		        emit Transfer(msg.value, msg.sender, _to, block.timestamp);
		 }
}
```

1. **Compile the Spell:**
    - Compile the contract in Remix.
2. **Deploy the Spell:**
    - Deploy the contract to a testnet (e.g., Goerli) using Remix.
3. **Invoke the Spell:**
    - Call the `transferEth` function to send ETH to a specified address.

### Logs and Receipts: Tracking Everything

Every time a transaction occurs on Ethereum, **logs** and **transaction receipts** are generated. These are crucial for **tracking** and **verifying** what happens in the network.

- **Logs** are created by **smart contracts** when they want to log something, like an event. Each log contains:
    - The **contract’s address** that created the log.
    - A list of **topics** (basically tags for what’s happening).
    - Any **data** related to the event.
    
    ![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/image%202.webp?raw=true)
    

Logs are then stored in a **Bloom filter**, a **data structure** that makes it easier to search through all the logs efficiently.

- **Transaction receipts** are like a **receipt** you’d get at a store. They contain important details about the transaction:
    - Block number and hash.
    - Gas used by the transaction.
    - Logs created during the transaction.
    
    ![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/image%203.webp?raw=true)
    

## Ethereum Gas

![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/b7c7ccfd-f4ba-45a3-9e83-130bf4af0152.webp?raw=true)

Let’s talk about Ethereum's **gas**. No, not the kind that fuels your car or powers up your stove—this gas is what powers Ethereum's computations! Every time you send a transaction or deploy a smart contract, Ethereum charges you a fee in **gas**. It’s like Ethereum’s way of saying, “Hey, this computation costs something,” and just like anything in life, **nothing’s free**!

### Gas Limit: Setting Your Budget

The **gas limit** is like your **maximum budget** for a transaction. It's the maximum amount of gas you're willing to use to execute your transaction. If your transaction doesn’t use the full limit, you’ll get the unused gas back (yay for savings!).

![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/image%204.webp?raw=true)

If you set a **low gas limit** and the transaction requires more, your transaction will fail, and you’ll **lose the gas** you spent up to that point (ouch!). So, be mindful of setting an appropriate gas limit—too high is wasteful, too low risks failure!

### Gas Calculation: How Much Does It Really Cost?

The concept of **gas** is designed to measure how much computational work is required to execute a transaction or smart contract on the Ethereum network. **Gas price** is how much Ether (ETH) you're willing to pay for each unit of gas. It's important to note that different operations (such as sending ETH, executing a smart contract, or storing data) require different amounts of gas to process.

![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/image%205.webp?raw=true)

When calculating the total gas cost for executing a smart contract, you must account for **transaction costs** and **execution costs**. Here’s how these components factor into the calculation:

### Gas Components

1. **Transaction Cost**:
    - This is the gas cost for submitting a transaction to the Ethereum network.
    - Includes costs for:
        - Signing the transaction.
        - Broadcasting it to the network.
2. **Execution Cost**:
    - Gas used to execute the logic of the smart contract.
    - Depends on the complexity of the operations (e.g., storage updates, loops, and conditional logic).

### Total Gas Cost Formula

The total cost in ETH is calculated as:

![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/image%206.webp?raw=true)


### Detailed Breakdown

1. **Transaction Gas Cost**:
    - A standard **base transaction** (like transferring ETH) costs **21,000 gas**.
    - Gas usage increases if the transaction carries additional data.
2. **Execution Gas Cost**:
    - **Storage Operations**: Writing to storage costs **20,000 gas** per 32 bytes.
    - **Execution**: Function calls, loops, and computations have specific gas costs.
    - **Reverting Transactions**: Failed transactions consume all gas up to the failure point.


### Example Calculation

Let’s calculate the total gas cost for deploying a smart contract that consumes:

- **Transaction Gas**: 21,000.
- **Execution Gas**: 40,000.
- **Gas Price**: 20 gwei (1 gwei = 10^-9 ETH).

![image.png](https://github.com/0xmetaschool/Learning-Projects/blob/main/assests_for_all/Mastering%20Ethereum%20From%20Blocks%20to%20Brilliance/2.%20The%20Ethereum%20Blockchain%20Paradigm/5.%20Ethereum%20Gas%20%26%20Smart%20Contracts/image%207.webp?raw=true)

Simple, right? But here's the twist: **gas price** is **dynamic**, and it fluctuates based on **demand**. More on that soon!

### Key Points

1. **Dynamic Gas Price**:
    - Gas prices fluctuate based on demand.
    - Higher gas prices = faster transaction execution (miners prioritize higher-paying transactions).
2. **Unspent Gas**:
    - If the transaction uses less gas than the gas limit, the unused gas is refunded.
3. **Gas Limit**:
    - Set a gas limit high enough to cover the execution. Insufficient gas results in transaction failure.

### Optimizing Gas Costs

- **Minimize Storage Operations**: Avoid excessive writing to the blockchain.
- **Efficient Code**: Optimize loops and minimize redundant operations.
- **Batch Operations**: Combine multiple actions into a single transaction.

### Gas Price: Why Does It Fluctuate?

Now, here's where the fun starts: **gas prices aren’t static**. Just like the price of gas at your local station, **Ethereum gas prices fluctuate** depending on the demand for the network.

- **High Demand**: Gas prices go up.
- **Low Demand**: Gas prices go down

When there’s a **traffic jam** on Ethereum (like when a big NFT drop happens or during network congestion), gas prices **spike**. If you want your transaction to go through quickly, you’ll need to **pay more gas** to get miners to prioritize your transaction.

The **gas price** is measured in **gwei**, which is a smaller unit of Ether (ETH). The more gwei you offer, the more likely your transaction will be processed quickly.


### EIP-1559: The Base Fee Mechanism—Game Changer!

Now, let’s talk about Ethereum’s secret weapon in the battle against fluctuating gas fees: **EIP-1559**.

Introduced in **London Upgrade**, **EIP-1559** made a huge change to Ethereum's gas pricing mechanism. Instead of miners bidding for gas prices, **EIP-1559 introduces a base fee** that adjusts dynamically depending on network congestion. This base fee is burned (destroyed) instead of going to miners, which makes **ETH more scarce** over time.

Here’s the flow:

- **Base Fee**: The minimum price required to process a transaction, burned to reduce ETH supply.
- **Tip (Priority Fee)**: An optional extra amount you can pay to get your transaction processed faster.

So, with EIP-1559, **base fees** help stabilize gas prices, but **miners** still get rewarded through tips (priority fees). Cool, right? And did we mention the burning mechanism helps make ETH more deflationary? 🤑


### Gas Refund: Getting Your Money Back!

The Ethereum network is all about **efficiency**—and if you’re smart with your gas, you can actually get a refund! How? When you **clear storage** (delete data from the blockchain), you get a **gas refund**.

Why? Because you’re helping to reduce the Ethereum state size. When you delete data, Ethereum rewards you for freeing up space, which reduces the computational load on the network.

**Pro Tip**: Storing data on the blockchain costs a lot of gas. So, always clean up your storage when you're done!


### Gas Price Dynamics: Why Miners Matter

At the end of the day, Ethereum’s **gas prices** are determined by **miners** (or **validators** in the case of Proof of Stake). They decide which transactions to include in a block, and they’re incentivized to pick transactions that offer the highest gas price.

However, miners are **not forced** to accept the highest gas price—they may reject transactions if the base fee (EIP-1559) is low, or if it doesn’t meet their minimum threshold. This means gas prices can be unpredictable, depending on the network congestion, miner priorities, and how much people are willing to pay to get their transactions processed.


### Gas Fees & Ethereum’s Network Health

The beauty of **gas** in Ethereum is that it not only powers the system, but also acts as a **demand signal**. High gas prices generally mean the network is in **high demand**, which can indicate a healthy, thriving ecosystem! But it also means that users need to be **smart** about when and how they use the network, or risk getting hit by **sky-high fees**.

And with **EIP-1559**, Ethereum has taken major steps to tame the wild ride of gas fees, giving users a clearer and more predictable way to manage costs.

## The Final Word on Gas

In summary, **gas** is Ethereum's way of measuring computational work. Every transaction has a gas cost, and the total cost is determined by the **gas price** and **gas limit**. Network congestion, miner preferences, and the EIP-1559 upgrade all influence gas prices, and **storage** comes with its own price tag too.

By understanding how **gas** works, you can ensure that your Ethereum transactions are efficient, cost-effective, and executed without a hitch. So next time you're about to make a transaction, think about how much you're willing to pay in gas—and remember, it’s not just about price, it’s also about **network health**!